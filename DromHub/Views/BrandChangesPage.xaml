<Page x:Class="DromHub.Views.BrandChangesPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="using:Microsoft.UI.Xaml.Controls"
      xmlns:vm="using:DromHub.ViewModels"
      xmlns:converters="using:DromHub.Converters">
    <Page.Resources>
        <SolidColorBrush x:Key="PatchCardBackground" Color="#141821" />
        <SolidColorBrush x:Key="PatchCardBorder" Color="#1AFFFFFF" />
        <SolidColorBrush x:Key="SectionBackground" Color="#0F1F2E" />
        <SolidColorBrush x:Key="SectionBorder" Color="#14FFFFFF" />
        <SolidColorBrush x:Key="EntryBackground" Color="#121A23" />
        <SolidColorBrush x:Key="MutedForeground" Color="#B3D1E8" />
        <SolidColorBrush x:Key="HeaderForeground" Color="#FFFFFFFF" />
        <FontFamily x:Key="PatchFont">/Assets/Fonts/SF-Pro.ttf#SF Pro</FontFamily>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter" />
    </Page.Resources>

    <Grid Background="#0D121A">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="24,24,24,12" Spacing="4">
            <TextBlock Text="История изменений"
                       FontFamily="{StaticResource PatchFont}"
                       FontSize="28"
                       FontWeight="SemiBold"
                       Foreground="{StaticResource HeaderForeground}" />
            <TextBlock Text="Следите за актуальными правками бренда и каталога"
                       FontFamily="{StaticResource PatchFont}"
                       FontSize="15"
                       Foreground="{StaticResource MutedForeground}" />
        </StackPanel>

        <Grid Grid.Row="1">
            <ScrollViewer VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Padding="24,0,24,24">
                <ItemsRepeater ItemsSource="{Binding Patches}">
                    <ItemsRepeater.Layout>
                        <controls:StackLayout Orientation="Vertical" Spacing="24" />
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="vm:ChangeLogPatchGroup">
                            <Border Background="{StaticResource PatchCardBackground}"
                                    BorderBrush="{StaticResource PatchCardBorder}"
                                    BorderThickness="1"
                                    CornerRadius="24"
                                    Padding="28,24">
                                <StackPanel Spacing="20">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Orientation="Vertical" Spacing="6">
                                            <TextBlock Text="{x:Bind HeaderDisplay}" 
                                                       FontFamily="{StaticResource PatchFont}"
                                                       FontSize="24"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource HeaderForeground}" />
                                            <TextBlock Text="{x:Bind ReleaseDateDisplay}"
                                                       FontFamily="{StaticResource PatchFont}"
                                                       FontSize="14"
                                                       Foreground="{StaticResource MutedForeground}" />
                                        </StackPanel>
                                        <Border Grid.Column="1"
                                                VerticalAlignment="Center"
                                                Padding="12,6"
                                                CornerRadius="16"
                                                Background="#1F2A3A">
                                            <TextBlock Text="Патчноут"
                                                       FontFamily="{StaticResource PatchFont}"
                                                       FontSize="13"
                                                       Foreground="{StaticResource MutedForeground}" />
                                        </Border>
                                    </Grid>

                                    <ItemsRepeater ItemsSource="{x:Bind Sections}">
                                        <ItemsRepeater.Layout>
                                            <controls:StackLayout Orientation="Vertical" Spacing="16" />
                                        </ItemsRepeater.Layout>
                                        <ItemsRepeater.ItemTemplate>
                                            <DataTemplate x:DataType="vm:ChangeLogSectionGroup">
                                                <Border Background="{StaticResource SectionBackground}"
                                                        BorderBrush="{StaticResource SectionBorder}"
                                                        BorderThickness="1"
                                                        CornerRadius="20"
                                                        Padding="20">
                                                    <StackPanel Spacing="14">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Border Width="6"
                                                                    Height="30"
                                                                    CornerRadius="4"
                                                                    Background="{x:Bind AccentBrush}" />
                                                            <TextBlock Grid.Column="1"
                                                                       Margin="12,0,0,0"
                                                                       Text="{x:Bind Title}"
                                                                       FontFamily="{StaticResource PatchFont}"
                                                                       FontSize="20"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="{StaticResource HeaderForeground}" />
                                                            <Border Grid.Column="2"
                                                                    VerticalAlignment="Center"
                                                                    Padding="10,4"
                                                                    CornerRadius="12"
                                                                    Background="{x:Bind AccentBrush, Mode=OneWay}">
                                                                <TextBlock Text="{x:Bind CategoryDisplay}"
                                                                           FontFamily="{StaticResource PatchFont}"
                                                                           FontSize="12"
                                                                           Foreground="Black"
                                                                           FontWeight="SemiBold" />
                                                            </Border>
                                                        </Grid>

                                                        <ItemsRepeater ItemsSource="{x:Bind Entries}">
                                                            <ItemsRepeater.Layout>
                                                                <controls:StackLayout Orientation="Vertical" Spacing="12" />
                                                            </ItemsRepeater.Layout>
                                                            <ItemsRepeater.ItemTemplate>
                                                                <DataTemplate x:DataType="vm:ChangeLogEntryItem">
                                                                    <Border Background="{StaticResource EntryBackground}"
                                                                            CornerRadius="16"
                                                                            Padding="18,16"
                                                                            BorderBrush="{StaticResource SectionBorder}"
                                                                            BorderThickness="1">
                                                                        <Grid ColumnSpacing="16">
                                                                            <Grid.ColumnDefinitions>
                                                                                <ColumnDefinition Width="Auto" />
                                                                                <ColumnDefinition Width="*" />
                                                                            </Grid.ColumnDefinitions>
                                                                            <Border Width="44"
                                                                                    Height="44"
                                                                                    CornerRadius="12"
                                                                                    Background="{x:Bind ImpactBrush}" 
                                                                                    HorizontalAlignment="Left"
                                                                                    VerticalAlignment="Top">
                                                                                <Image Source="{x:Bind IconAssetUri}"
                                                                                       Width="24"
                                                                                       Height="24"
                                                                                       HorizontalAlignment="Center"
                                                                                       VerticalAlignment="Center" />
                                                                            </Border>
                                                                            <StackPanel Grid.Column="1" Spacing="6">
                                                                                <TextBlock Text="{x:Bind Headline}"
                                                                                           FontFamily="{StaticResource PatchFont}"
                                                                                           FontSize="18"
                                                                                           FontWeight="SemiBold"
                                                                                           Foreground="{StaticResource HeaderForeground}" />
                                                                                <TextBlock Text="{x:Bind Description}"
                                                                                           FontFamily="{StaticResource PatchFont}"
                                                                                           FontSize="14"
                                                                                           TextWrapping="WrapWholeWords"
                                                                                           Foreground="{StaticResource MutedForeground}" />
                                                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                                                    <Border Background="{x:Bind ImpactBrush}"
                                                                                            CornerRadius="10"
                                                                                            Padding="10,4">
                                                                                        <TextBlock Text="{x:Bind ImpactLabel}"
                                                                                                   FontFamily="{StaticResource PatchFont}"
                                                                                                   FontSize="12"
                                                                                                   FontWeight="SemiBold"
                                                                                                   Foreground="Black" />
                                                                                    </Border>
                                                                                    <TextBlock Text="{x:Bind TargetSummary}"
                                                                                               FontFamily="{StaticResource PatchFont}"
                                                                                               FontSize="12"
                                                                                               Foreground="{StaticResource MutedForeground}"
                                                                                               VerticalAlignment="Center"
                                                                                               Visibility="{x:Bind TargetSummary, Converter={StaticResource NullToVisibilityConverter}}" />
                                                                                </StackPanel>
                                                                            </StackPanel>
                                                                        </Grid>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsRepeater.ItemTemplate>
                                                        </ItemsRepeater>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsRepeater.ItemTemplate>
                                    </ItemsRepeater>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </ScrollViewer>

            <Grid x:Name="EmptyState"
                  Background="Transparent"
                  Visibility="{Binding HasHistory, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=invert}">
                <TextBlock Text="{Binding EmptyStateMessage}"
                           FontFamily="{StaticResource PatchFont}"
                           FontSize="16"
                           Foreground="{StaticResource MutedForeground}"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           TextAlignment="Center" />
            </Grid>

            <Grid Background="#B3000000"
                  Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}"
                  IsHitTestVisible="{Binding IsBusy}">
                <ProgressRing Width="64"
                              Height="64"
                              IsActive="True" />
            </Grid>
        </Grid>
    </Grid>
</Page>

