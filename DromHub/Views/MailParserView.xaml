<Page
    x:Class="DromHub.Views.MailParserView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="using:DromHub.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <conv:ConnectionStatusConverter x:Key="ConnectionStatusConverter"/>
        <conv:DoubleToPercentConverter x:Key="PercentFmt" Format="F0"/>
    </Page.Resources>


    <!-- Ð’Ð½ÐµÑˆÐ½ÑÑ Ð¿Ñ€Ð¾ÐºÑ€ÑƒÑ‚ÐºÐ° â€” Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÐ¼ Ð²ÑÑ‘ Ð² ScrollViewer -->
    <ScrollViewer Padding="20" VerticalScrollBarVisibility="Auto">
        <!-- Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð²ÐµÑ€Ñ‚Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÑ‚ÐµÐº-Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ† -->
        <StackPanel Spacing="20">

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <TextBlock Text="ÐŸÐ°Ñ€ÑÐµÑ€ Ð¿Ð¾Ñ‡Ñ‚Ñ‹"
                       FontSize="24"
                       FontWeight="Bold"/>

            <!-- Ð‘Ð»Ð¾Ðº: Ð²Ñ‹Ð±Ð¾Ñ€ Ð¿Ð¾Ñ‡Ñ‚Ð¾Ð²Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð° (StackPanel Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸) -->
            <Border Background="White"
                    BorderBrush="LightGray"
                    BorderThickness="1"
                    CornerRadius="8"
                    Padding="15">
                <StackPanel Spacing="12">
                    <TextBlock Text="ÐŸÐ¾Ñ‡Ñ‚Ð¾Ð²Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€" FontWeight="SemiBold" FontSize="16"/>
                    <ComboBox ItemsSource="{Binding MailServerTypes}"
                              SelectedIndex="{Binding SelectedMailServerIndex, Mode=TwoWay}"
                              PlaceholderText="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ð¾Ñ‡Ñ‚Ð¾Ð²Ñ‹Ð¹ ÑÐµÑ€Ð²ÐµÑ€"/>

                    <!-- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ ÑÐµÑ€Ð²ÐµÑ€Ð° -->
                    <StackPanel Visibility="{Binding CustomServerVisibility, Mode=OneWay}" Spacing="8">
                        <TextBox Header="Ð¡ÐµÑ€Ð²ÐµÑ€ IMAP"
                                 Text="{Binding CustomServer, Mode=TwoWay}"
                                 PlaceholderText="imap.example.com"/>
                        <TextBox Header="ÐŸÐ¾Ñ€Ñ‚"
                                 Text="{Binding CustomPort, Mode=TwoWay}"
                                 PlaceholderText="993"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Ð‘Ð»Ð¾Ðº: ÑƒÑ‡Ñ‘Ñ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ -->
            <!-- ÐŸÐ¾Ð»Ñ Ð´Ð»Ñ Ð²Ð²Ð¾Ð´Ð° ÑƒÑ‡ÐµÑ‚Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… -->
            <Border Background="White"
        BorderBrush="LightGray"
        BorderThickness="1"
        CornerRadius="8"
        Padding="15">
                <StackPanel Spacing="15">
                    <TextBlock Text="Ð£Ñ‡ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ" FontWeight="SemiBold" FontSize="16"/>

                    <TextBox Header="Email Ð°Ð´Ñ€ÐµÑ"
             Text="{Binding EmailAddress, Mode=TwoWay}"
             PlaceholderText="user@example.com"/>

                    <PasswordBox x:Name="PasswordBox"
                                 Header="ÐŸÐ°Ñ€Ð¾Ð»ÑŒ"
                                 PlaceholderText="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"
                                 PasswordChanged="PasswordBox_OnPasswordChanged"/>

                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <CheckBox Content="Ð—Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ Ð¼ÐµÐ½Ñ"
                IsChecked="{Binding RememberCredentials, Mode=TwoWay}" />
                        <Button Content="Ð—Ð°Ð±Ñ‹Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ"
              Command="{Binding ForgetSavedCredentialsCommand}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <Button Content="ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ"
              Command="{Binding ConnectAndDownloadCommand}"
              Background="#0078D4"
              Foreground="White"
              Padding="15,10"/>

                        <Button Content="ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ"
              Command="{Binding ClearCredentialsCommand}"
              Background="LightGray"
              Padding="15,10"/>
                    </StackPanel>
                </StackPanel>
            </Border>


            <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ -->
            <Border Background="White"
        BorderBrush="LightGray"
        BorderThickness="1"
        CornerRadius="8"
        Padding="15">
                <StackPanel Spacing="10">
                    <TextBlock Text="Ð¡Ñ‚Ð°Ñ‚ÑƒÑ" FontWeight="SemiBold" FontSize="16"/>

                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                        <ProgressRing IsActive="{Binding IsLoading}" Height="20" Width="20"/>
                        <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° -->
                    <StackPanel Spacing="6">
                        <TextBlock Text="{Binding ProgressDetails}" />
                        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                            <ProgressBar Minimum="0" Maximum="100" Height="8"
                     Value="{Binding ParsingProgress}" Width="300"/>
                            <TextBlock Text="{Binding ParsingProgress, Converter={StaticResource PercentFmt}}"/>
                        </StackPanel>
                        <TextBlock>
    <Run Text="ÐŸÐ¾ÑÑ‚Ð°Ð²Ñ‰Ð¸Ðº: "/>
    <Run Text="{Binding CurrentSupplier}"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Ð‘Ð»Ð¾Ðº: Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ + Ð»Ð¾Ð³ â€” Ð´Ð²Ðµ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ (Grid), Ð¿Ð¾Ñ‚Ð¾Ð¼Ñƒ Ñ‡Ñ‚Ð¾ Ð½ÑƒÐ¶ÐµÐ½ ÑÐ°Ð¹Ð´Ð±Ð°Ð¹ÑÐ°Ð¹Ð´ -->
            <Grid ColumnDefinitions="1*, 2*" ColumnSpacing="20">
                <!-- ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° 0: Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (StackPanel Ð²Ð½ÑƒÑ‚Ñ€Ð¸) -->
                <Border Grid.Column="0"
                        Background="White"
                        BorderBrush="LightGray"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="15">
                    <StackPanel Spacing="10">
                        <TextBlock Text="Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ" FontWeight="SemiBold" FontSize="16"/>

                        <Button Content="ðŸ“ ÐžÑ‚ÐºÑ€Ñ‹Ñ‚ÑŒ Ð¿Ð°Ð¿ÐºÑƒ Prices"
            Command="{Binding OpenPricesFolderCommand}"
            Background="LightGray"
            Padding="15,10"/>

                        <Button Content="âž• Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð¹Ñ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ"
            Command="{Binding ManualAddPricesCommand}"
            Background="#0078D4"
            Foreground="White"
            Padding="15,10"/>
                    </StackPanel>


                </Border>

                <!-- ÐšÐ¾Ð»Ð¾Ð½ÐºÐ° 1: Ð›Ð¾Ð³ (StackPanel + ScrollViewer Ð´Ð»Ñ ÑÐ¿Ð¸ÑÐºÐ°) -->

                <StackPanel Spacing="10" Grid.Column="1" Height="1000">
                    <TextBlock Text="Ð›Ð¾Ð³ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹" FontWeight="SemiBold" FontSize="16"/>
                    <ScrollViewer x:Name="LogScrollViewer"
              VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding LogEntries}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" TextWrapping="Wrap" Margin="0,4,0,4"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </Grid>

        </StackPanel>
    </ScrollViewer>
</Page>
