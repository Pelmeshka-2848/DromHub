<Page
    x:Class="DromHub.Views.BrandPage"
    x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:converters="using:DromHub.Converters"
    mc:Ignorable="d">

    <Page.Resources>
        <!-- Конвертеры -->
        <converters:NullToBooleanConverter x:Key="NullToBooleanConverter"/>
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
        <converters:BoolToFontWeightConverter x:Key="BoolToFontWeightConverter"/>

        <!-- Источник сгруппированных брендов -->
        <CollectionViewSource x:Key="BrandCvs"
                              Source="{Binding GroupedBrands}"
                              IsSourceGrouped="True"
                              ItemsPath="Items"/>
    </Page.Resources>

    <Grid Padding="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Основной контент -->
        <Grid Grid.Row="1" Margin="0,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ===== Левая колонка: Бренды (растяжение + граница) ===== -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <!-- ListView тянется -->
                    <RowDefinition Height="Auto"/>
                    <!-- (зарезервировано, если понадобятся локальные кнопки) -->
                </Grid.RowDefinitions>

                <Border Grid.Row="0"
                        BorderThickness="1"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        CornerRadius="8">
                    <ListView
                        ItemsSource="{Binding Source={StaticResource BrandCvs}}"
                        SelectionMode="Single"
                        SelectedItem="{Binding SelectedBrand, Mode=TwoWay}"
                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <!-- Название + (кол-во деталей) -->
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{Binding Name}"/>
                                    <TextBlock Text="(" Opacity="0.6"/>
                                    <TextBlock Text="{Binding PartsCount, TargetNullValue=0}" Opacity="0.6"/>
                                    <TextBlock Text=")" Opacity="0.6"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>

                        <ListView.GroupStyle>
                            <GroupStyle>
                                <GroupStyle.HeaderTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Key}"
                                                   FontWeight="Bold"
                                                   FontSize="16"
                                                   Margin="8,8,8,4"/>
                                    </DataTemplate>
                                </GroupStyle.HeaderTemplate>
                            </GroupStyle>
                        </ListView.GroupStyle>
                    </ListView>
                </Border>
            </Grid>

            <!-- Вертикальный разделитель -->
            <Rectangle Grid.Column="1"
                       Width="1"/>

            <!-- ===== Правая колонка: Синонимы (заголовок + растягивающийся ListView + кнопки) ===== -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- заголовок -->
                    <RowDefinition Height="*"/>
                    <!-- ListView тянется -->
                    <RowDefinition Height="Auto"/>
                    <!-- кнопки -->
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0"
                           Text="Синонимы:"
                           FontWeight="Bold"
                           Margin="0,0,0,8"/>

                <Border Grid.Row="1"
                        BorderThickness="1"
                        BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                        CornerRadius="8">
                    <ListView
                        ItemsSource="{Binding Aliases}"
                        SelectedItem="{Binding SelectedAlias, Mode=TwoWay}"
                        x:Name="AliasesList"
                        ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <ItemsStackPanel/>
                            </ItemsPanelTemplate>
                        </ListView.ItemsPanel>

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Alias}"
                                               Margin="0,0,12,0"
                                               FontWeight="{Binding IsPrimary, Converter={StaticResource BoolToFontWeightConverter}}"/>
                                    <TextBlock Text="{Binding Note}" Opacity="0.6"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </Border>

                <!-- Кнопки управления синонимами -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                    <Button
                        Content="Редактировать"
                        Command="{Binding EditAliasCommand}"
                        CommandParameter="{Binding ElementName=PageRoot, Path=XamlRoot}"
                        IsEnabled="{Binding CanEditOrDeleteAlias}"
                        MinWidth="100"/>

                    <Button
                        Content="Удалить"
                        Command="{Binding DeleteAliasCommand}"
                        CommandParameter="{Binding ElementName=PageRoot, Path=XamlRoot}"
                        IsEnabled="{Binding CanEditOrDeleteAlias}"
                        MinWidth="100"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Кнопки действий страницы -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="12"
                    Margin="0,12,0,0">
            <Button Content="Добавить бренд"
                    Click="AddBrand_Click"
                    MinWidth="120"
                    Padding="12,6"/>

            <Button Content="Удалить бренд"
                    Command="{Binding DeleteBrandCommand}"
                    CommandParameter="{Binding ElementName=PageRoot, Path=XamlRoot}"
                    MinWidth="120"
                    Padding="12,6"
                    IsEnabled="{Binding SelectedBrand, Converter={StaticResource NullToBooleanConverter}}"/>

            <Button Content="Добавить синоним"
                    Click="AddAlias_Click"
                    MinWidth="120"
                    Padding="12,6"
                    IsEnabled="{Binding SelectedBrand, Converter={StaticResource NullToBooleanConverter}}"/>
        </StackPanel>
    </Grid>
</Page>